---
description: Java 21 ì˜ ê°€ìƒ ìŠ¤ë ˆë“œì— ê´€í•´
---

# ğŸ•¶ï¸ Java : Virtual Thread

Java 21 ì—ì„œ ë„ì…ëœ ê°€ìƒ ìŠ¤ë ˆë“œëŠ” Javaì˜ ìŠ¤ë ˆë“œ ëª¨ë¸ì„ ê°œì„ í•´ ë™ì‹œì„± ì²˜ë¦¬ ì„±ëŠ¥ì„ í¬ê²Œ í–¥ìƒ ì‹œì¼°ë‹¤.

## **ê¸°ì¡´ ìŠ¤ë ˆë“œ ëª¨ë¸ì˜ ë¬¸ì œì **

ê¸°ì¡´ ìŠ¤ë ˆë“œ ëª¨ë¸ì˜ ê²½ìš° ì»¤ë„ ìŠ¤ë ˆë“œ ê¸°ë°˜ìœ¼ë¡œ ìš´ì˜ì²´ì œì— ì˜í•´ ê´€ë¦¬ë˜ëŠ” ì‹¤ì œ ìŠ¤ë ˆë“œì— ë§¤í•‘ë˜ê³ ,\
ì„±ëŠ¥ì´ ì¢‹ê³  ì•ˆì •ì ì´ë‹¤.

í•˜ì§€ë§Œ&#x20;

**ë¹„ìš©ì´ ë¹„ì‹¸ë‹¤** :\
&#x20;ì»¤ë„ ìŠ¤ë ˆë“œëŠ” ìƒì„±, ìŠ¤ìœ„ì¹­, ê´€ë¦¬ë¥¼ ìš´ì˜ì²´ì œê°€ ì²˜ë¦¬í•˜ê¸° ë•Œë¬¸ì— ë¬´ê²ë‹¤. \
ë”°ë¼ì„œ ë§ì€ ìŠ¤ë ˆë“œë¥¼ ë™ì‹œì— ìƒì„±í•˜ë©´ ì„±ëŠ¥ ë¬¸ì œë‚˜ ë©”ëª¨ë¦¬ ì˜¤ë²„í—¤ë“œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

**ë¸”ë¡œí‚¹ I/O :** \
ìŠ¤ë ˆë“œê°€ ë¸”ë¡œí‚¹ I/O ì‘ì—…ì„ í•  ë•Œ, ë‹¤ë¥¸ì‘ì—…ë“¤ì´ ê¸°ë‹¤ë ¤ì•¼ í•˜ëŠ” ìƒí™©ì´ ë°œìƒí•˜ê³  ì´ë¥¼ ìœ„í•´ \
ë¹„ë™ê¸° I/O ì²˜ë¦¬ë¥¼ í•˜ê¸°ë„ í•˜ì§€ë§Œ ì´ëŠ” ì½”ë“œë³µì¡ë„ë¥¼ í–¥ìƒì‹œí‚¤ëŠ” ë¶€ì‘ìš©ì´ ìˆë‹¤.&#x20;

## **ê°€ìƒ ìŠ¤ë ˆë“œ**

Java 21ì˜ ê°€ìƒ ìŠ¤ë ˆë“œëŠ” **ì»¤ë„ ìŠ¤ë ˆë“œ**ì™€ëŠ” ë‹¬ë¦¬, **JVM**ì´ ê´€ë¦¬í•˜ëŠ” ë§¤ìš° ê°€ë²¼ìš´ ìŠ¤ë ˆë“œë‹¤.\
ê¸°ì¡´ì˜ ìŠ¤ë ˆë“œì²˜ëŸ¼ ë™ì‘í•˜ì§€ë§Œ, ìš´ì˜ì²´ì œì˜ ì»¤ë„ ìŠ¤ë ˆë“œì™€ ì§ì ‘ì ìœ¼ë¡œ ë§¤í•‘ë˜ì§€ ì•Šì•„ \
ëŒ€ê·œëª¨ì˜ ìŠ¤ë ˆë“œë¥¼ ì‰½ê²Œ ìƒì„±í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.

**ì£¼ìš” íŠ¹ì§•:**

**ê°€ë²¼ì›€**: \
ê°€ìƒ ìŠ¤ë ˆë“œëŠ” ì»¤ë„ ìŠ¤ë ˆë“œë³´ë‹¤ í›¨ì”¬ ê°€ë³ë‹¤. \
ìˆ˜ë°±ë§Œ ê°œì˜ ìŠ¤ë ˆë“œë„ ìƒì„±í•  ìˆ˜ ìˆì„ ì •ë„ë¡œ ë©”ëª¨ë¦¬ì™€ ìì›ì„ ì ê²Œ ì‚¬ìš©í•œë‹¤.

**ë™ì‹œì„± ì²˜ë¦¬ ê°œì„ **: \
ë§ì€ ìˆ˜ì˜ ìŠ¤ë ˆë“œë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, \
ëŒ€ê·œëª¨ ë™ì‹œì„±ì„ ìš”êµ¬í•˜ëŠ” ì‘ì—…(ì˜ˆ: ì„œë²„ ì• í”Œë¦¬ì¼€ì´ì…˜)ì— ìœ ë¦¬í•¨.

**ê¸°ì¡´ ì½”ë“œì™€ì˜ í˜¸í™˜ì„±**: \
ê¸°ì¡´ ìŠ¤ë ˆë“œì™€ ê°€ìƒ ìŠ¤ë ˆë“œëŠ” ì„œë¡œ êµì²´ ê°€ëŠ¥í•˜ë©°, \
í° ì½”ë“œ ìˆ˜ì • ì—†ì´ ê°€ìƒ ìŠ¤ë ˆë“œë¥¼ ì ìš©í•  ìˆ˜ ìˆë‹¤ .&#x20;

**ë¸”ë¡œí‚¹ I/O ë¬¸ì œ í•´ê²°**: \
ê°€ìƒ ìŠ¤ë ˆë“œëŠ” ë¸”ë¡œí‚¹ I/O ì‘ì—… ì¤‘ì— ìŠ¤ë ˆë“œë¥¼ ìë™ìœ¼ë¡œ ì¤‘ë‹¨(suspend)í•˜ê³ ,\
&#x20;I/Oê°€ ì™„ë£Œë˜ë©´ ë‹¤ì‹œ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤. \
ì´ëŠ” ë¹„ë™ê¸° I/Oë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ ë„, ë™ê¸°ì‹ ì½”ë“œ ì‘ì„±ì´ ê°€ëŠ¥í•˜ë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.

## **ì˜ˆì‹œ ì½”ë“œ**&#x20;

1\. `Thread.ofVirtual()`

```java
public class VirtualThreadExample {
    public static void main(String[] args) {
        // ê°€ìƒ ìŠ¤ë ˆë“œ ìƒì„± ë° ì‹¤í–‰
        Thread virtualThread = Thread.ofVirtual().start(() -> {
            System.out.println("Hello from a virtual thread!");
        });

        // ê°€ìƒ ìŠ¤ë ˆë“œê°€ ëë‚  ë•Œê¹Œì§€ ëŒ€ê¸°
        try {
            virtualThread.join();
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
}
```

2. ê°€ìƒ ìŠ¤ë ˆë“œ ë§ì´ ìƒì„± í•´ë³´ê¸° (ë³‘ë ¬ìŠ¤íŠ¸ë¦¼ ì‚¬ìš© ì‹œ ë” ë§ì€ ë³‘ë ¬ì²˜ë¦¬ë„ ê°€ëŠ¥)

```java
import java.util.stream.IntStream;

public class ManyVirtualThreadsExample {
    public static void main(String[] args) {
        // ë³‘ë ¬ë¡œ ê°€ìƒ ìŠ¤ë ˆë“œë¥¼ ì‹¤í–‰
        IntStream.range(0, 100000)
                 .parallel()
                 .forEach(i -> Thread.ofVirtual().start(() -> {
                     System.out.println("Virtual thread: " + Thread.currentThread());
                 }));
    }
}
```

3. ê°€ìƒ ìŠ¤ë ˆë“œ í’€ ì‚¬ìš© (ê°œì¸ í”„ë¡œì íŠ¸ ì‹œ ë¹„ë™ê¸° ê¸°ëŠ¥ê³¼ í•¨ê»˜ ì‚¬ìš©)

```java
import com.backend.immilog.global.exception.AsyncUncaughtExceptionHandlerCustom;
import org.springframework.aop.interceptor.AsyncUncaughtExceptionHandler;
import org.springframework.context.annotation.Configuration;
import org.springframework.scheduling.annotation.AsyncConfigurerSupport;
import org.springframework.scheduling.annotation.EnableAsync;

import java.util.concurrent.Executor;
import java.util.concurrent.Executors;


@Configuration
@EnableAsync
public class AsyncConfig extends AsyncConfigurerSupport {

    @Override
    public Executor getAsyncExecutor() {
        return Executors.newVirtualThreadPerTaskExecutor();
    }

    @Override
    public AsyncUncaughtExceptionHandler getAsyncUncaughtExceptionHandler() {
        return new AsyncUncaughtExceptionHandlerCustom();
    }
}
```

## ì •ë¦¬

í•µì‹¬ ë‚´ìš© ìë°”ëŠ” ì´ì œ ìˆ˜ë°±ë§Œ ê°œì˜ ê°€ìƒ ìŠ¤ë ˆë“œë¥¼ ë™ì‹œì— ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ ëë‹¤. \
OS ìŠ¤ë ˆë“œë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ì§€ ì•Šê³  JDKì—ì„œ ì‚¬ìš©ì ëª¨ë“œë¡œ êµ¬í˜„.\
\
ì™œ í•„ìš”í–ˆë‚˜? \
ì„œë²„ëŠ” ë§ì€ ë™ì‹œ ìš”ì²­ì„ ì²˜ë¦¬í•´ì•¼ í•˜ëŠ”ë°, OS ìŠ¤ë ˆë“œëŠ” ë„ˆë¬´ ë¬´ê±°ì›Œì„œ í•œê³„ê°€ ìˆì—ˆë‹¤.\
\
êµ¬í˜„ \
ê¸°ì¡´ Thread í´ë˜ìŠ¤ë¥¼ ì¶”ìƒí™”í•´ì„œ ê°€ìƒ ìŠ¤ë ˆë“œë¥¼ êµ¬í˜„í–ˆë‹¤. \
ì»¨í‹°ë‰´ì—ì´ì…˜ê³¼ ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ ê²°í•©í•œ í˜•íƒœë¡œ, ê¸°ì¡´ ì½”ë“œì™€ í˜¸í™˜ì„±ì„ ìœ ì§€í•˜ë©´ì„œë„ ê°€ë³ê²Œ ë§Œë“¤ì—ˆë‹¤. \
\
ì¥ì ê³¼ íŠ¹ì§• \
\- ì´ˆë‹¹ 300ë§Œê°œ ì´ìƒì˜ ìƒˆë¡œìš´ ìŠ¤ë ˆë“œ ìƒì„± ê°€ëŠ¥ \
\- ê¸°ì¡´ ìë°” ì½”ë“œì™€ ì™„ë²½í•œ í˜¸í™˜ \
\- ìŠ¤ë ˆë“œ í’€ì´ í•„ìš” ì—†ì–´ì§ \
\- ë””ë²„ê¹…ê³¼ í”„ë¡œíŒŒì¼ë§ ë„êµ¬ë“¤ë„ ê·¸ëŒ€ë¡œ ì‚¬ìš© ê°€ëŠ¥\
\
ì´ì œ ê°œë°œìë“¤ì´ ìŠ¤ë ˆë“œë¥¼ "ê´€ë¦¬í•´ì•¼ í•  ë¦¬ì†ŒìŠ¤"ë¡œ ë³´ëŠ” ê´€ì ì„ ë°”ê¾¸ëŠ” ê²Œ ì¤‘ìš”í•˜ë‹¤. \
ê°€ìƒ ìŠ¤ë ˆë“œëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ í‘œí˜„í•˜ëŠ” ê°ì²´ë¡œ ë´ì•¼ í•˜ê¸°ë•Œë¬¸!\![\
](https://www.threads.net/@greatherakles)
