# 🔀 CS : Context Switching

## What is Context Switching?

컨텍스트 스위칭(Context Switching)이란 CPU가 현재 실행 중인 프로세스나 \
스레드의 실행 상태(Context)를 저장하고, \
다음에 실행할 프로세스나 스레드의 상태를 불러와 교체하는 과정을 의미한다. \
이는 멀티태스킹 시스템에서 여러 작업이 동시에 처리되는 것처럼 보이게 하는 핵심 메커니즘이다.

### Context?

컨텍스트는 현재 실행 중인 작업의 **레지스터 상태(프로그램 카운터, 스택 포인터 등)** 와\
&#x20;**메모리 관련 정보**를 포함한 전체 실행 상태를 뜻한다. \
컨텍스트가 있어야 나중에 해당 작업이 중단된 지점부터 다시 재개될 수 있다.

***

## Why Context Switching is Needed

멀티태스킹 환경에서는 CPU가 여러 작업을 시간 단위로 전환하며 실행한다. \
사용자에게는 동시에 실행되는 것처럼 보이지만 실제로는 CPU가 빠르게 작업을 전환하는 것이다.

**Context Switching은 다음 상황에서 발생한다:**

* **Time Slice 만료**: 할당된 CPU 사용 시간이 끝났을 때
* **I/O 대기**: 작업이 디스크/네트워크 등의 I/O를 기다릴 때
* **우선순위 전환**: 더 높은 우선순위 작업이 나타났을 때

Context Switching은 항상 **커널 모드**에서 수행되며, 운영체제의 **스케줄러**와 **CPU 제어 모듈**이 이를 담당한다.

***

## Thread vs Process Context Switching

| 항목         | 프로세스 컨텍스트 스위칭 | 스레드 컨텍스트 스위칭  |
| ---------- | ------------- | ------------- |
| 실행 주체      | 다른 프로세스       | 같은 프로세스 내 스레드 |
| 주소 공간      | 완전히 다름        | 메모리 공간 공유     |
| TLB 초기화    | 필요함           | 필요 없음         |
| MMU 주소 전환  | 필요함           | 불필요           |
| 레지스터 저장/복구 | O             | O             |
| 속도         | 느림            | 빠름            |

***

## Flow

<figure><img src="../../.gitbook/assets/스크린샷 2025-05-13 22.57.09.png" alt=""><figcaption></figcaption></figure>

***

## Why Thread Switching is Faster

스레드 컨텍스트 스위칭은 프로세스에 비해 빠른 이유는 다음과 같다:

* 같은 주소 공간을 공유하므로 MMU(메모리 관리 유닛)를 재설정할 필요가 없다.
* 가상 주소와 물리 주소 간의 매핑 정보를 담고 있는 TLB(Translation Lookaside Buffer)를 초기화하지 않아도 된다.
* 레지스터만 저장하고 복원하면 바로 다음 스레드 실행이 가능하다.

반면, 프로세스 컨텍스트 스위칭은 다음 추가 작업이 필요하다:

* 새로운 프로세스의 주소 공간으로 전환하기 위해 **MMU의 페이지 테이블**을 전환해야 함
* **TLB 캐시를 비워야** 함 (이전 프로세스의 메모리 주소 접근을 막기 위함)
* 메모리 매핑 정보까지 바꾸기 때문에 시간/리소스가 더 든다

***

## Conclusion

멀티태스킹 환경에서는 컨텍스트 스위칭이 필수적이지만, 비용이 완전히 동일하지 않다.\
**스레드 간 스위칭은 상대적으로 빠르며, 프로세스 간 스위칭은 주소 공간과 메모리 구조까지 바뀌기 때문에 더 무겁다.**\
이를 이해하고 백엔드 아키텍처를 설계하면, 더 나은 쓰레드/프로세스 모델 선택이 가능하다..!
