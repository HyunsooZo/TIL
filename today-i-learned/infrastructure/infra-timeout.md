---
description: 프로그래밍을 하면서 가장 만나기 싫은 타임아웃의 종류에 대해 간단히 알아보았다.
---

# 😩 Infra : Timeout

## Connection Timeout?

클라이언트가 서버에 연결을 시도할 때, 일정 시간 안에 연결이 성립되지 않으면 발생하는 타임아웃이다.\
TCP 기반의 통신에서는 3-way-handshake 과정을 통해 세션을 수립한다.\
`Connection Timeout`은 이 과정이 정해진 시간 내에 완료되지 않을 경우 발생한다.

> 즉, 서버가 죽어 있거나 네트워크가 단절된 경우, 연결 자체가 불가능하므로 발생하는 타임아웃이다.

***

## Socket Timeout?

서버와의 연결이 이미 완료된 이후, 데이터를 주고받는 중에 발생할 수 있는 타임아웃이다.\
클라이언트는 서버로부터 데이터를 스트리밍 받는 형태로 전달받는데, \
이때 패킷 단위로 데이터가 도착한다.

`Socket Timeout`은 **각 패킷 간의 시간 간격**이 일정 시간 이상 지연될 때 발생한다.\
서버가 다음 데이터를 보내지 않거나, 전송이 지연되는 경우 클라이언트는 타임아웃을 발생시키고 연결을 종료할 수 있다.

***

## Read Timeout?

서버와 연결이 성립된 이후, 데이터를 읽어들이는 과정에서 일정 시간 동안 \
아무 데이터도 도착하지 않으면 발생하는 타임아웃이다.\
예를 들어, 응답 지연이 심한 외부 API를 호출했는데 서버가 아무 응답도 하지 않는다면, \
`Read Timeout`이 발생할 수 있다.

> 단순히 연결만 되어 있다고 모든 게 끝이 아니며, 응답을 정상적으로 받아야 비로소 통신이 유효한 것이다.

***

## Why is Timeout Important?

타임아웃은 **서버 자원의 낭비를 막기 위해 꼭 필요하다.**

예를 들어, 외부 API 요청이 무한정 지연된다면 해당 요청을 처리하고 있는 쓰레드나 커넥션을 계속 유지해야 한다.\
이는 자원의 고갈을 초래하며, 대기 중인 다른 요청을 처리하지 못하게 되어 서비스 전체에 장애를 일으킬 수 있다.

> 설정된 타임아웃은 서비스가 **자기 자신을 보호**하는 하나의 안전장치이다.

***

## How to Test Timeout?

타임아웃은 테스트 환경에서 다음과 같은 방식으로 검증할 수 있다:

1. **가짜 API 서버를 구성**하여 일정 시간 동안 응답을 지연시킨다.
2. 서버 사이드에서 `Thread.sleep()`을 활용해 일부러 느리게 응답한다.
3. Nginx 등 프록시 레벨에서 지연을 인위적으로 주는 방식도 가능하다.

```java
@RestController
public class TestController {
    @GetMapping("/delay")
    public String delay() throws InterruptedException {
        Thread.sleep(50000); // 50초 지연
        return "done";
    }
}
```

이런 식으로 응답 지연을 유도하여 `connectionTimeout`, `readTimeout`, `socketTimeout` \
설정을 적용했을 때 어떻게 동작하는지 확인할 수 있다.

***

## Is Timeout Testing Always Necessary?

반드시 테스트해야 한다고 단정할 수는 없다.\
타임아웃 테스트는 신중하게 접근할 필요가 있다.

* 얻을 수 있는 것: **정상적인 예외 처리 로직 확인**, 서비스 회복력 확보
* 잃는 것: **테스트 시간 증가**, 자동화된 테스트의 속도 저하, 테스트 환경 구성 비용

따라서, 실제로 타임아웃이 중요한 경로(API, DB, 외부 연동)라면 꼭 테스트해보는 것이 좋고,\
단순한 내부 연동이거나 타임아웃 발생 가능성이 거의 없다면 굳이 무리해서 테스트하지 않아도 된다.

~~사실 일정에 맞춰 개발하다보면 타임아웃 테스트까지 진행 할 여유도 없다...ㅜㅜ~~

> 결국
>
> **"테스트로 인한 비용과 테스트를 안 했을 때의 위험 중 어느 쪽이 더 큰가?"**\
> 이 판단이 타임아웃 테스트의 핵심이다.
